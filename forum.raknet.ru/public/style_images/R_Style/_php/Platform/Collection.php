<?php
 Platform::load('Platform/Getter'); abstract class Platform_Collection extends Platform_Getter { protected $_default; protected $_selected; protected function _process(&$elements) { foreach( $elements as $key => &$element ) { if( isset($element['enabled']) && !$element['enabled'] ) { continue; } $element['key'] = $key; $element['selected'] = false; $this->_default($element); $this->_selected($element); $this->_each($element); } unset($element); $this->_fallback_strategy($elements); } abstract protected function _each(&$element); protected function _default(&$element) { if( isset($element['default']) && $element['default'] ) { $this->_default = &$element; } } abstract protected function _selected(&$element); protected function _fallback_strategy(&$elements) { if( $this->_selected === null ) { $this->_selected =& $this->_default; } if( $this->_selected === null ) { reset($elements); $this->_selected = current($elements); } $this->_selected['selected'] = true; } }